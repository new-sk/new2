# 6-1. 데이터베이스 설계

### **가. 저장 공간 설계** 

테이블, 테이블스페이스에 대해서 알아봅시다

<br>

테이블 구조 
- Heap-Organized Table : 순서와 관계없이 데이터 저장
- Index Organized Table / Clustered Index Table : 인덱스 값의 순서대로 데이터 저장, 소량 데이터 랜덤 엑세스에 성능 향상
- Partitioned Table : (범위, 해쉬, 리스트) 파티션별 저장, 삭제, 추가 등등
- External Table : 파일 데이터
- Temporary Table : 트랜잭션 또는 세션 단위, 공유 안됨

컬럼 설계
- 참조 관계에 있는 것은 데이터 타입 동일하게
- 고정컬럼, NOT NULL은 앞에
- 가변결이, NULL 많은 경우는 뒤에
- 체인 발생 적게 나도록 해야 함
  
테이블 설계
- 컬럼 데이터 길이가 1블록/페이지 보다 크면 체인 발생 가능
- 수직 분할 고려 : 특정 컬럼 사용 빈도 높거나, 사용자 그룹이 다르거나
- 수직 분할 후 하나의 트랜잭션에 동시에 처리되는 것이 많으면 안됨
- 시간 가공이 빈번한 경우에는 텍스트로

테이블과 테이블스페이스
- 테이블은 테이블스페이스라는 논리적인 단위와 연관, 테이블스페이스는 데이터 파일이라는 물리적인 단위와 연관
- 업무별로 지정, 큰 것은 별도로, 인덱스와는 분리, LOB는 독립적으로

용량 설계
- 확장성과 가용성 / 디스크 채널 병목 최소화
- 초기 사이즈 / 증가 사이즈 / 트랜잭션 옵션 / 최대 사이즈 / 자동 증가 옵션
- 용량 분석 / 오브젝트별 용량 산정 / 테이블스페이스 용량 산정 / 디스크 용량 산정 (IO분산)

<br>


### **나. 무결성 설계**

정확성, 일관성, 유효성, 신뢰성을 위해 무효 갱신으로부터 데이터 보호가 필요합니다.

<br>

무결성 강화 방법
- 응용 프로그램 : 소스코드에 분산, 관리 어려움, 적정성 검토 어려움
- 트리거 : 운영중 변경 어려움, 사용상 주의 필요
- 제약조건 : 복잡한 내역으로 구성 불가, 예외 처리 불가

실체 무결성 (PK, UK)
- 기본키 제약 : NOT NULL, UNIQUE
- UNIQUE 제약 : 후보키 대상인 UK, NULL 가능, PK선언만으로 클러스터드 인덱스 테이블 구조 생성, 
- 채번시 시퀀스(시리얼) 활용이 바람직함

영역 무결성 (Domain)
- 데이터 타입 & 길이
- 유효값 (Check)
- NOT NULL (숫자 NOT NULL, default 0)

참조 무결성 (FK)
- **입력 무결성 종류**
- **수정/삭제 무결성 종류**
- 참조 무결성에는 NULL 지정은 바람직하지 않음 : default 사용 필요
- 슈퍼-서브타입 : 삽입시 depdendent, automatic, 변경시 cascade
- 성능상 이슈, 반드시 적용 필요한 관계에만
- 인덱스 생성 필요

<br>


### **다. 인덱스 설계**

인덱스는 데이터를 좀 더 빠르게 접근하는 것.

<br>

PK, UK, FK : 무결성 검증 위해 인덱스 필요

인덱스 설계
- 접근 경로 수집 : 
- 분포도 조사에 의한 후보 컬럼 선정 : 단일 컬럼 우선 선정
  - 분포도 = 데이터별 평균 로우수 / 테이블 총 로우수
- 접근 경로 결정
- 컬럼 조합 및 순서 결정
- 적용 시험 : 의도된 실행계획으로 작동되는지, 다른 SQL문 영향도도 확인 필요

인덱스 구조
- B트리 : 입력/수정/삭제 용이함, 스캔범위 넓으면 랜덤 IO 발생
- 비트맵 : 대량데이터, 분포도 낮을때, 비트 연산, 입력/수정/삭제 어려움